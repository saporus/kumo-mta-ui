server {
  listen 80;
  server_name mail.example.com;

  # Redirect /ui â†’ /ui/
  location = /ui {
    return 301 /ui/;
  }

  # API proxy (must be before the alias block)
  location /ui/api/ {
    proxy_pass http://127.0.0.1:5055/;
    proxy_set_header X-API-Key CHANGE_ME;  # same as /opt/kumo-ui-api/.env
    proxy_http_version 1.1;
  }

  # Static UI (served from /var/www/kumo-ui)
  location /ui/ {
    alias /var/www/kumo-ui/;
    try_files $uri $uri/ /index.html;
    # Optional hardening:
    # add_header Cache-Control "public, max-age=300";
  }
}
